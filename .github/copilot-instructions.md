# Guidance for AI coding agents (Claude Developer Tool)

Keep this short and actionable — the goal is to let an AI coding agent become productive immediately.

## Big picture
- This is an Electron + React (Vite) app with a clear main/renderer/preload separation.
- Main process: `src/main` — app lifecycle, single-instance lock, window creation, and registration of IPC handlers.
- Preload: `src/preload/index.ts` — exposes a safe `window.api` via `contextBridge`. Use this for all main<->renderer interactions.
- Renderer: `src/renderer` — React + MUI UI. In development the renderer runs on Vite at `http://localhost:3001` (BrowserRouter). In production the built `dist/renderer/index.html` is loaded with HashRouter.
- Core service: `src/main/services/ClaudeDesktopManager.ts` — reads/writes Claude config files under platform-specific paths (`src/shared/constants.ts`) and can restart/launch the external Claude Desktop app on macOS/Windows.

## IPC / API contract (use these exactly)
- Main handles (see `src/main/ipc/*.ts`) and preload expose these invocations on `window.api`:
  - `window.api.claudeDesktop.getInfo()` -> returns `ClaudeDesktopInfo` (see `src/shared/types.ts`)
  - `window.api.claudeDesktop.getMCPServers()` -> { enabled, disabled }
  - `window.api.claudeDesktop.disableMCPServer(name)` / `enableMCPServer(name)`
  - `window.api.claudeDesktop.reorderMCPServers(names[])` / `reorderDisabledMCPServers(names[])`
  - `window.api.claudeDesktop.restart()`
  - `window.api.window.*` -> `minimize`, `maximize`, `close`, `isMaximized`
  - `window.api.system.*` -> `getTheme`, `getLocale`, `getVersion`

When changing IPC names or shapes, update both `src/main/ipc/*` and `src/preload/index.ts` together and adjust renderer usages in `src/renderer`.

## Project-specific conventions and important files
- Use `yarn` (project expects Yarn 4). Node >= 22 is required (see `package.json.engines`).
- Dev workflow (scripts in `package.json`):
  - `yarn dev` runs three processes: main TypeScript watch (`tsc -w -p tsconfig.main.json`), Vite dev server, and `electron` after build output is ready. Dev renderer is at `http://localhost:3001`.
  - `yarn build` = `tsc -p tsconfig.main.json && vite build`
  - `yarn start` runs the packaged app with `electron .` (expect `dist/main/index.js` present for production)
- Platform config: config files live under `CLAUDE_CONFIG_PATHS` (see `src/shared/constants.ts`). Tests or code that modify configs must respect the platform-specific path logic.
- The manager writes two files: `claude_desktop_config.json` (enabled) and `claude_desktop_config_disabled.json` (disabled). Moving between enabled/disabled is implemented by reading/writing these files in `ClaudeDesktopManager`.

## Quick tasks an agent may be asked to do (and pitfalls)
- Add or change an IPC handler: update `src/main/ipc/*`, expose call in `src/preload/index.ts`, and consume in renderer. Missing any of these 3 will break runtime behavior.
- Modify config schema: update `src/shared/types.ts`, `ClaudeDesktopManager` read/write logic, and renderer components that render `MCPServerConfig` fields.
- Restart/launch behavior: `ClaudeDesktopManager.restartClaudeDesktop()` only supports `win32` and `darwin`. If adding Linux support, implement executable discovery and process management carefully.

## Debug / run tips for agents
- To run locally as a developer: run `yarn install` (Yarn v4), then `yarn dev`. Wait for `dist/main/index.js` to be generated by `tsc` before electron starts (script handles this via `wait-on`).
- To debug renderer: open DevTools (dev mode automatically opens detached DevTools). Renderer uses BrowserRouter in dev — when testing routes in dev use `http://localhost:3001`.
- To debug main process: add console logs in `src/main/*` and inspect stdout from the `yarn dev` terminal (concurrently runs multiple processes).

## Files to inspect when making changes
- Main entry: `src/main/index.ts`
- IPC handlers: `src/main/ipc/claudeDesktopHandlers.ts`, `systemHandlers.ts`, `windowHandlers.ts`
- Service logic: `src/main/services/ClaudeDesktopManager.ts`
- Preload API: `src/preload/index.ts` (source of truth for renderer API)
- Shared types/constants: `src/shared/types.ts`, `src/shared/constants.ts`
- Renderer components that call the API: `src/renderer/components/ClaudeDesktopManager.tsx`, `src/renderer/App.tsx`

## Code style & safety notes
- The app uses strict separation between main and renderer. Do not import `electron` into renderer files — use `window.api` instead.
- `contextIsolation: true` and `contextBridge.exposeInMainWorld` are used; keep the preload surface minimal and typed (see exported `API` type in `src/preload/index.ts`).
- IO operations (reading/writing config files) are synchronous in `ClaudeDesktopManager`. Be careful to preserve ordering and error handling when refactoring to async.

## If you change build or runtime scripts
- Update `package.json` scripts and ensure `yarn dev` still runs three processes (main watch, vite, electron) or update README and developer instructions accordingly.

---

If anything above is unclear or you want additional examples (unit tests, refactors, or adding an IPC endpoint), tell me which area to expand and I will update this file.
